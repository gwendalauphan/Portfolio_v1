.update-variable-managment-template: # &update-variable-managment-template
  image: alpine:latest
  script:
    - |
      apk add --no-cache curl
      echo "Déploiement du projet : $PROJECT_NAME"
      echo "Image utilisée : $REGISTRY_IMAGE"
      echo "Environnement : $ENV_DEPLOYMENT"
      echo "Variables d'environnement : $VARS_ENV"
      if [[ -z "$PROJECT_NAME" || -z "$ENV_DEPLOYMENT" ]]; then
        echo "Erreur : PROJECT_NAME ou ENV_DEPLOYMENT est vide, mise à jour impossible."
        exit 1
      fi
      if [ -n "$ACTIVE" ]; then
        if [ "$ACTIVE" != "true" ] && [ "$ACTIVE" != "false" ]; then
          echo "Erreur : ACTIVE doit être 'true' ou 'false'"
          exit 1
        fi
      fi
      echo "application déployée : $ACTIVE"
      curl -X POST --fail \
      -F token=$CI_JOB_TOKEN \
      -F ref=main \
      -F "variables[REGISTRY_IMAGE]=$REGISTRY_IMAGE" \
      -F "variables[PROJECT_NAME]=$PROJECT_NAME" \
      -F "variables[ENV_DEPLOYMENT]=$ENV_DEPLOYMENT" \
      -F "variables[VARS_ENV]=$VARS_ENV" \
      -F "variables[ACTIVE]=$ACTIVE" \
      https://gitlab.com/api/v4/projects/$VARIABLES_MANAGMENT_PROJECT_ID/trigger/pipeline
